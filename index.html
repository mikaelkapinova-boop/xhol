<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Msplomberie - Jeux de Cartes Multijoueur</title>

  <style>
    /* RESET et styles globaux */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      background-color: #1b1120;
      color: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      user-select: none;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* HEADER commun */
    header {
      background-color: #2a1f34;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 0 12px #5d3e84;
      color: #e1cfff;
      user-select: none;
    }

    header .user-info {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    header .user-info img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 2px solid #ffcf19;
      object-fit: cover;
    }

    header .user-info .username {
      font-weight: 700;
      font-size: 1.25rem;
    }

    header .user-stats {
      display: flex;
      gap: 12px;
      font-size: 0.9rem;
      color: #d7caef;
      align-items: center;
    }

    nav a {
      color: #d7caef;
      text-decoration: none;
      margin-left: 20px;
      font-weight: 600;
      padding: 6px 14px;
      border-radius: 6px;
      transition: background 0.3s ease;
      cursor: pointer;
    }

    nav a:hover {
      background-color: #ffcf19;
      color: #230f00;
    }

    /* FORMULAIRES AUTH */
    #auth-section {
      min-height: 100vh;
      background: #170e22;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 50px 20px;
      gap: 24px;
    }

    .auth-box {
      background: #362c51;
      border-radius: 18px;
      padding: 36px 34px;
      width: 360px;
      max-width: 88vw;
      box-shadow: 0 5px 38px #4e3d74bb;
      color: white;
      user-select: none;
    }

    .auth-box h2 {
      font-weight: 700;
      font-size: 1.9rem;
      margin-bottom: 24px;
      letter-spacing: 0.12rem;
      color: #ffcf19;
      text-align: center;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 1rem;
      color: #c6b7f3;
    }

    input[type="email"],
    input[type="password"] {
      width: 100%;
      padding: 12px 14px;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
      outline-offset: 2px;
      outline-color: #a792e0;
      margin-bottom: 18px;
    }

    input[type="submit"],
    button.link-btn {
      width: 100%;
      background: #ffcf19;
      border: none;
      color: #311a04;
      font-weight: 700;
      font-size: 1.15rem;
      border-radius: 10px;
      padding: 14px 0;
      margin-top: 12px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }

    input[type="submit"]:hover,
    button.link-btn:hover {
      background-color: #fff055;
    }

    button.link-btn {
      background: none;
      color: #99afff;
      text-decoration: underline;
      margin-top: 14px;
      padding: 0;
      border-radius: 0;
      font-weight: 600;
      cursor: pointer;
      user-select: text;
    }

    .error-msg {
      color: #ff6060;
      font-weight: 700;
      font-size: 0.9rem;
      min-height: 20px;
      margin-bottom: 6px;
    }

    .success-msg {
      color: #84ff84;
      font-weight: 700;
      font-size: 0.9rem;
      margin-top: 6px;
    }

    .hidden {
      display: none !important;
    }

    /* LOBBY / MODE DE JEU */
    main#modes {
      flex: 1;
      background: #120817;
      padding: 50px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .modes-header {
      width: 100%;
      max-width: 720px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
    }

    .user-info-lobby {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .user-info-lobby img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 2px solid #ffcf19;
      object-fit: cover;
    }

    .user-info-lobby .username {
      font-weight: 700;
      font-size: 1.25rem;
      color: #ffc75e;
    }

    .user-stats-lobby {
      display: flex;
      gap: 15px;
      font-size: 0.95rem;
      color: #d3c7f8;
      align-items: center;
      user-select: none;
    }

    nav#lobby-nav a {
      background: #382a5c;
      color: #fff;
      text-decoration: none;
      font-weight: 700;
      padding: 10px 24px;
      margin-left: 15px;
      border-radius: 10px;
      transition: background-color 0.3s ease;
    }

    nav#lobby-nav a:hover {
      background-color: #ffc75e;
      color: #1a0700;
    }

    .modes {
      max-width: 720px;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 60px;
    }

    .mode-card {
      background-color: #3a2860;
      width: 280px;
      border-radius: 22px;
      padding: 40px 28px;
      text-align: center;
      box-shadow: 0 0 30px #5b43a1aa;
      border: 2px solid #634b9a;
      cursor: pointer;
      transition: transform 0.3s, border-color 0.3s;
      user-select: none;
    }

    .mode-card:hover,
    .mode-card:focus {
      border-color: #ffc75e;
      transform: scale(1.06);
      box-shadow: 0 0 48px #ffdb79cc;
      outline: none;
    }

    .mode-card img {
      height: 80px;
      margin-bottom: 18px;
      filter: drop-shadow(0 0 6px #271a54bb);
      user-select: none;
    }

    .mode-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #ffd964;
      margin-bottom: 10px;
      letter-spacing: 0.04em;
      text-shadow: 0 0 18px #ffd964bb;
    }

    .mode-desc {
      font-size: 1.1rem;
      color: #d7c7f8;
      line-height: 1.4;
      user-select: none;
    }

    /* TABLE DE JEU */
    main#game {
      flex: 1;
      background: #120817;
      padding: 30px 10px 60px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
    }

    main#game header {
      width: 100%;
      max-width: 900px;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #cabdf3;
    }

    main#game header .user-info {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    main#game header .user-info img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 2px solid #ffd964;
      object-fit: cover;
      user-select: none;
    }

    main#game header nav a {
      color: #e6d8fd;
      font-weight: 600;
      padding: 8px 14px;
      background: #3a2a5d;
      border-radius: 8px;
      margin-left: 17px;
      transition: background-color 0.3s ease;
      cursor: pointer;
      user-select: none;
      text-decoration: none;
    }

    main#game header nav a:hover {
      background-color: #ffd964;
      color: #361c00;
    }

    .game-table {
      background-color: #3a2c58;
      border-radius: 26px;
      padding: 36px 32px 56px;
      max-width: 900px;
      width: 95vw;
      box-shadow: 0 0 36px #6d58abcc;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .table-areas {
      display: flex;
      justify-content: space-between;
      width: 100%;
      margin-bottom: 36px;
      gap: 14px;
    }

    .drop-zone {
      background-color: #512f82;
      border-radius: 14px;
      min-height: 140px;
      flex-grow: 1;
      padding: 18px 12px;
      box-shadow: inset 0 0 16px #9169c4aa;
      display: flex;
      flex-wrap: nowrap;
      align-items: center;
      overflow-x: auto;
      gap: 8px;
      border: 2px dashed #a788e6;
      transition: background-color 0.3s ease, border-color 0.3s ease;
      cursor: default;
    }

    .drop-zone.dragover {
      background-color: #cca7ff44;
      border-color: #d3baff;
    }

    .player-hand {
      width: 100%;
      max-width: 900px;
      background-color: #44136f;
      border-radius: 16px;
      padding: 16px 14px;
      box-shadow: 0 3px 14px #573686aa;
      display: flex;
      gap: 14px;
      overflow-x: auto;
      user-select: none;
      cursor: default;
      min-height: 110px;
    }

    .card {
      width: 72px;
      height: 100px;
      background-color: #160d2a;
      border-radius: 10px;
      border: 2px solid transparent;
      box-shadow: 0 3px 14px rgb(5 5 5 / 0.8);
      padding: 6px 8px;
      font-weight: 700;
      user-select: none;
      cursor: grab;
      transition: box-shadow 0.25s ease, border-color 0.25s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      color: #fff;
    }

    .card.red {
      color: #e44a3a;
    }

    .card.dragging {
      opacity: 0.5;
      cursor: grabbing;
      box-shadow: 0 0 36px 8px #ffd964;
    }

    #xholBtn {
      margin-top: 30px;
      background: #ffd964;
      color: #210;
      border-radius: 12px;
      border: none;
      padding: 16px 70px;
      font-size: 1.6rem;
      font-weight: 800;
      opacity: 0.45;
      cursor: not-allowed;
      user-select: none;
      transition: opacity 0.25s ease;
      box-shadow: 0 0 18px #ccaaffaa;
    }

    #xholBtn.enabled {
      opacity: 1;
      cursor: pointer;
      box-shadow: 0 0 28px 2px #d5bc66ff;
    }

    /* FOOTER */
    footer {
      background: #2e2440;
      padding: 20px;
      font-size: 1rem;
      color: #c1b2e5cc;
      text-align: center;
      user-select: none;
    }
  </style>
</head>

<body>

  <!-- SECTION AUTHENTIFICATION -->
  <section id="auth-section">
    <article id="login-box" class="auth-box">
      <h2>Connexion</h2>
      <form id="login-form" autocomplete="off" novalidate>
        <label for="login-email">E-mail</label>
        <input type="email" id="login-email" autocomplete="username" required />
        <label for="login-password">Mot de passe</label>
        <input type="password" id="login-password" autocomplete="current-password" minlength="6" required />
        <input type="submit" value="Se connecter" />
        <p id="login-error" class="error-msg" aria-live="polite"></p>
      </form>
      <button type="button" class="link-btn" onclick="showRegister()">Créer un compte</button>
    </article>

    <article id="register-box" class="auth-box hidden">
      <h2>Créer un compte</h2>
      <form id="register-form" autocomplete="off" novalidate>
        <label for="register-email">E-mail</label>
        <input type="email" id="register-email" autocomplete="username" required />
        <label for="register-password">Mot de passe (6 caractères minimum)</label>
        <input type="password" id="register-password" autocomplete="new-password" minlength="6" required />
        <input type="submit" value="S'inscrire" />
        <p id="register-error" class="error-msg" aria-live="polite"></p>
      </form>
      <button type="button" class="link-btn" onclick="showLogin()">Déjà un compte ? Connexion</button>
    </article>
  </section>

  <!-- PAGE LOBBY AVANT JEU -->
  <main id="modes" class="hidden">
    <header>
      <div class="user-info user-info-lobby" role="region" aria-label="Profil utilisateur">
        <img src="https://randomuser.me/api/portraits/men/1.jpg" alt="Avatar utilisateur" id="user-avatar" />
        <span class="username" id="user-pseudo">pseudo</span>
        <div class="user-stats user-stats-lobby">
          <span title="Niveau">Niv. <strong id="user-level">1</strong></span>
          <span title="Gemmes">💎 <strong id="user-gems">35</strong></span>
          <span title="Pièces">🪙 <strong id="user-coins">70780</strong></span>
        </div>
      </div>

      <nav id="lobby-nav" aria-label="Menu principal">
        <a href="#" title="Accueil" onclick="event.preventDefault()">Accueil</a>
        <a href="#" title="Déconnexion" onclick="logout()">Déconnexion</a>
      </nav>
    </header>

    <div class="modes" role="region" aria-label="Choix des modes de jeu">
      <div class="mode-card" tabindex="0" role="button" aria-label="Mode Casual - jeu pour le plaisir"
        onclick="startGame('casual')">
        <img src="https://cdn-icons-png.flaticon.com/512/616/616554.png" alt="Icône casual" />
        <div class="mode-title">Casual</div>
        <div class="mode-desc">Jouez pour le plaisir contre d'autres joueurs !</div>
      </div>
      <div class="mode-card" tabindex="0" role="button" aria-label="Mode Tournoi - défis et classements"
        onclick="startGame('tournament')">
        <img src="https://cdn-icons-png.flaticon.com/512/616/616601.png" alt="Icône tournoi" />
        <div class="mode-title">Tournoi</div>
        <div class="mode-desc">Relevez des défis et grimpez dans le classement !</div>
      </div>
    </div>
  </main>

  <!-- PAGE TABLE DE JEU -->
  <main id="game" class="hidden" role="main" aria-label="Table de jeu">
    <header>
      <div class="user-info" role="region" aria-label="Profil utilisateur">
        <img src="https://randomuser.me/api/portraits/men/1.jpg" alt="Avatar utilisateur" id="user-avatar-game" />
        <span class="username" id="user-pseudo-game">pseudo</span>
        <div class="user-stats">
          <span title="Niveau">Niv. <strong id="user-level-game">1</strong></span>
          <span title="Gemmes">💎 <strong id="user-gems-game">35</strong></span>
          <span title="Pièces">🪙 <strong id="user-coins-game">70780</strong></span>
        </div>

        <nav aria-label="Menu principal" style="margin-left:auto;">
          <a href="#" title="Quitter la partie" onclick="quitGame()">Quitter la partie</a>
          <a href="#" title="Déconnexion" onclick="logout()">Déconnexion</a>
        </nav>
      </div>
    </header>

    <div class="game-table" id="game-table">
      <div class="table-areas">
        <div id="drop1" class="drop-zone" aria-label="Zone de pose 1"></div>
        <div id="drop2" class="drop-zone" aria-label="Zone de pose 2"></div>
      </div>

      <div id="player-hand" class="player-hand" aria-label="Main du joueur">
        <!-- Cartes injectées ici -->
      </div>

      <button id="xholBtn" disabled>Xhol</button>
    </div>
  </main>

  <footer>
    © 2025 Msplomberie - Jeux de Cartes Multijoueur - Jeu sans argent réel, sécurisé & gratuit
  </footer>

  <script>
    // ----- Gestion des comptes -----
    function getUsers() {
      let list = localStorage.getItem("msplomberie_accounts");
      return list ? JSON.parse(list) : {};
    }

    function saveUsers(accounts) {
      localStorage.setItem("msplomberie_accounts", JSON.stringify(accounts));
    }

    function simpleHash(str) {
      return btoa(unescape(encodeURIComponent(str)));
    }

    function showRegister() {
      document.getElementById("login-box").classList.add("hidden");
      document.getElementById("register-box").classList.remove("hidden");
      clearErrors();
    }

    function showLogin() {
      document.getElementById("register-box").classList.add("hidden");
      document.getElementById("login-box").classList.remove("hidden");
      clearErrors();
    }

    function clearErrors() {
      document.getElementById("login-error").textContent = "";
      document.getElementById("register-error").textContent = "";
    }

    document.getElementById("login-form").addEventListener("submit", function (e) {
      e.preventDefault();
      const email = this["login-email"].value.trim().toLowerCase();
      const password = this["login-password"].value;
      const errorElem = document.getElementById("login-error");
      errorElem.textContent = "";
      const users = getUsers();
      if (!users[email]) {
        errorElem.textContent = "Compte introuvable.";
        return;
      }
      if (users[email].password !== simpleHash(password)) {
        errorElem.textContent = "Mot de passe incorrect.";
        return;
      }
      sessionStorage.setItem("activeUser", email);
      loadUserProfile(email);
      showMainSection();
    });

    document.getElementById("register-form").addEventListener("submit", function (e) {
      e.preventDefault();
      const email = this["register-email"].value.trim().toLowerCase();
      const password = this["register-password"].value;
      const errorElem = document.getElementById("register-error");
      errorElem.textContent = "";
      if (!email.match(/^\S+@\S+\.\S+$/)) {
        errorElem.textContent = "Adresse email invalide.";
        return;
      }
      if (password.length < 6) {
        errorElem.textContent = "Le mot de passe doit contenir au moins 6 caractères.";
        return;
      }
      let users = getUsers();
      if (users[email]) {
        errorElem.textContent = "Ce compte existe déjà.";
        return;
      }
      users[email] = {
        password: simpleHash(password),
        profile: {
          pseudo: email.split("@")[0],
          niveau: 1,
          gemmes: 35,
          pieces: 70780,
        },
      };
      saveUsers(users);
      sessionStorage.setItem("activeUser", email);
      loadUserProfile(email);
      showMainSection();
    });

    // ----- Affichage profil -----
    function loadUserProfile(email) {
      const users = getUsers();
      if (!users[email]) return;

      const profile = users[email].profile;

      // Lobby
      document.getElementById("user-pseudo").textContent = profile.pseudo;
      document.getElementById("user-level").textContent = profile.niveau;
      document.getElementById("user-gems").textContent = profile.gemmes;
      document.getElementById("user-coins").textContent = profile.pieces;

      // Table jeu
      document.getElementById("user-pseudo-game").textContent = profile.pseudo;
      document.getElementById("user-level-game").textContent = profile.niveau;
      document.getElementById("user-gems-game").textContent = profile.gemmes;
      document.getElementById("user-coins-game").textContent = profile.pieces;

      const avatarIndex = (profile.pseudo.charCodeAt(0) + profile.niveau) % 99;

      document.getElementById("user-avatar").src =
        `https://randomuser.me/api/portraits/men/${avatarIndex}.jpg`;
      document.getElementById("user-avatar-game").src =
        `https://randomuser.me/api/portraits/men/${avatarIndex}.jpg`;
    }

    // ----- Navigation -----
    function showMainSection() {
      document.getElementById("auth-section").style.display = "none";
      document.getElementById("game").classList.add("hidden");
      document.getElementById("modes").classList.remove("hidden");
    }

    function logout() {
      sessionStorage.removeItem("activeUser");
      document.getElementById("auth-section").style.display = "flex";
      document.getElementById("modes").classList.add("hidden");
      document.getElementById("game").classList.add("hidden");
      clearErrors();
    }

    function quitGame() {
      document.getElementById("game").classList.add("hidden");
      document.getElementById("modes").classList.remove("hidden");
      clearGameTable();
    }

    // ----- Chargement session -----
    window.addEventListener("load", () => {
      const activeUser = sessionStorage.getItem("activeUser");
      if (activeUser) {
        loadUserProfile(activeUser);
        showMainSection();
      }
    });

    // ----- Logique jeu et table -----
    function createDeck() {
      const suits = ['coeur', 'carreau', 'pique', 'trefle'];
      const values = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'V', 'D', 'R'];

      let deck = [];

      for (let pack = 0; pack < 2; pack++) {
        for (const suit of suits) {
          for (const value of values) {
            deck.push({ value, suit });
          }
        }
      }

      deck.push({ value: 'Joker', suit: 'Joker' });
      deck.push({ value: 'Joker', suit: 'Joker' });

      return deck;
    }

    function createCardElement(cardObj, id) {
      const div = document.createElement("div");
      div.classList.add("card");
      div.setAttribute("draggable", "true");
      div.id = `card-${id}`;

      if (cardObj.value === 'Joker') {
        div.style.backgroundColor = "#111";
        div.style.color = "yellow";
        div.textContent = "🃏";
        div.style.fontSize = "2.8rem";
        div.style.textAlign = "center";
        div.style.lineHeight = "100px";
        div.style.userSelect = "none";
      } else {
        let cardColor = '#fff';
        if (cardObj.suit === 'coeur' || cardObj.suit === 'carreau') {
          cardColor = '#d33a3a';
          div.classList.add('red');
        }
        div.style.backgroundColor = "#28223c";
        div.style.border = `2px solid ${cardColor}`;
        div.style.color = cardColor;

        const topLeft = document.createElement("div");
        topLeft.textContent = `${cardObj.value} ${cardObj.suit === 'coeur' ? '♥' : cardObj.suit === 'carreau' ? '♦' : cardObj.suit === 'pique' ? '♠' : '♣'}`;
        topLeft.style.fontSize = "1.6rem";
        topLeft.style.lineHeight = "1.1";

        div.appendChild(topLeft);

        const bottomRight = document.createElement("div");
        bottomRight.textContent = topLeft.textContent;
        bottomRight.style.fontSize = "1.6rem";
        bottomRight.style.alignSelf = "flex-end";
        bottomRight.style.transform = "rotate(180deg)";
        bottomRight.style.lineHeight = "1.1";
        bottomRight.style.userSelect = "none";

        div.appendChild(bottomRight);
      }
      return div;
    }

    let handCardsElements = [];

    function dealInitialCards(deck) {
      deck = deck.sort(() => Math.random() - 0.5);
      const hand = deck.slice(0, 14);
      return { hand, remainingDeck: deck.slice(14) };
    }

    function renderHandCards(hand) {
      const handDiv = document.getElementById("player-hand");
      handDiv.innerHTML = "";
      handCardsElements = [];
      hand.forEach((card, idx) => {
        const cardEl = createCardElement(card, idx);
        handDiv.appendChild(cardEl);
        handCardsElements.push(cardEl);
      });
      addDragDropListeners();
    }

    function addDragDropListeners() {
      handCardsElements.forEach(cardEl => {
        cardEl.addEventListener("dragstart", dragStart);
        cardEl.addEventListener("dragend", dragEnd);
      });

      const dropZones = document.querySelectorAll(".drop-zone");
      dropZones.forEach(zone => {
        zone.addEventListener("dragover", dragOver);
        zone.addEventListener("drop", dropCard);
        zone.addEventListener("dragleave", dragLeave);
      });

      const handDiv = document.getElementById("player-hand");
      handDiv.addEventListener("dragover", dragOver);
      handDiv.addEventListener("drop", returnToHand);
      handDiv.addEventListener("dragleave", dragLeave);
    }

    let draggedCard = null;

    function dragStart(e) {
      draggedCard = this;
      this.classList.add("dragging");
      e.dataTransfer.effectAllowed = "move";
    }

    function dragEnd(e) {
      this.classList.remove("dragging");
      draggedCard = null;
    }

    function dragOver(e) {
      e.preventDefault();
      this.classList.add("dragover");
      e.dataTransfer.dropEffect = "move";
    }

    function dragLeave(e) {
      this.classList.remove("dragover");
    }

    function dropCard(e) {
      e.preventDefault();
      this.classList.remove("dragover");
      if (draggedCard) {
        this.appendChild(draggedCard);
        checkAllCardsPlaced();
      }
    }

    function returnToHand(e) {
      e.preventDefault();
      this.classList.remove("dragover");
      if (draggedCard) {
        this.appendChild(draggedCard);
        checkAllCardsPlaced();
      }
    }

    const xholBtn = document.getElementById("xholBtn");

    function checkAllCardsPlaced() {
      const handDiv = document.getElementById("player-hand");
      if (handDiv.children.length === 0) {
        xholBtn.disabled = false;
        xholBtn.classList.add("enabled");
      } else {
        xholBtn.disabled = true;
        xholBtn.classList.remove("enabled");
      }
    }

    xholBtn.addEventListener("click", () => {
      alert("Xhol activé : la main est prête !");
      // Ajoute ici ta logique de contrôle / validation
    });

    function clearGameTable() {
      document.getElementById("player-hand").innerHTML = "";
      document.getElementById("drop1").innerHTML = "";
      document.getElementById("drop2").innerHTML = "";
      xholBtn.disabled = true;
      xholBtn.classList.remove("enabled");
    }

    function startGame(mode) {
      document.getElementById("modes").classList.add("hidden");
      document.getElementById("game").classList.remove("hidden");
      clearGameTable();

      const deck = createDeck();
      const { hand } = dealInitialCards(deck);
      renderHandCards(hand);
      checkAllCardsPlaced();
    }

    function quitGame() {
      document.getElementById("game").classList.add("hidden");
      document.getElementById("modes").classList.remove("hidden");
      clearGameTable();
    }
  </script>

</body>

</html>
